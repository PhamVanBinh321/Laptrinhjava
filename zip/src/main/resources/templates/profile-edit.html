<!-- src/main/resources/templates/profile-edit.html -->
<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>Sửa hồ sơ - Hair Harmony</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link th:href="@{/css/styles.css}" rel="stylesheet" />
  <style>
    body { background:#EAE7D6; }
    .page-wrap { padding: 28px 0 42px; }
    .card {
      max-width: 960px; margin: 0 auto; background: #fff;
      border-radius: 18px; box-shadow: 0 2px 16px #5d7b6f1a;
      padding: 22px 20px 26px;
    }
    .title { color:#5D7B6F; font-weight:800; font-size:1.6rem; margin: 2px 0 12px; }
    .grid { display:grid; grid-template-columns: 1fr; gap:18px; }
    @media (min-width: 900px){ .grid { grid-template-columns: 320px 1fr; } }

    .field { margin-bottom: 12px; }
    .field label { display:block; font-weight:600; color:#5D7B6F; margin-bottom:8px; }
    .input, .file {
      width:90%; padding:10px 12px; border:1px solid #B0D4B8; border-radius:10px;
      background:#F7FDFD; color:#5D7B6F; font-size:1rem; outline: none;
    }
    .input:focus, .file:focus { box-shadow: 0 0 0 2px #B0D4B84d; }
    .help { color:#9aa6a0; font-size:.92rem; margin-top:6px; }

    .err { color:#b94a48; background:#fce8e6; border:1px solid #f5c6cb; padding:8px 10px; border-radius:10px; margin-top:6px; font-size:.95rem; }
    .alert { padding:10px 12px; border-radius:12px; margin: 8px 0 14px; }
    .alert-success { background:#e8fff0; border:1px solid #b6f0cd; color:#276749; }

    .avatar-box {
      display:flex; flex-direction:column; gap:14px; align-items:center; text-align:center;
      background:#f8fffe; border:1px dashed #B0D4B8; border-radius:16px; padding:16px;
    }
    .avatar-box img {
      width: 160px; height: 160px; object-fit: cover; border-radius: 16px;
      box-shadow: 0 2px 10px #a4c3a24d;
    }
    .btns { display:flex; gap:10px; flex-wrap: wrap; margin-top: 6px; }
    .btn {
      padding: 10px 16px; border:none; border-radius:12px; cursor:pointer;
      font-weight:700; font-size:1rem;
    }
    .btn-save { background:#5D7B6F; color:#fff; }
    .btn-save:hover { background:#A4C3A2; }
    .btn-cancel { background:#e7eeea; color:#5D7B6F; }
    .btn-cancel:hover { background:#d7e8df; }
  </style>
</head>
<body>

<!-- HEADER -->
<div th:replace="~{fragments/header :: siteHeader}"></div>

<main class="page-wrap">
  <div class="card">
    <div class="title">Sửa thông tin hồ sơ</div>

    <!-- Thông báo thành công (nếu có ?success=...) -->
    <div class="alert alert-success" th:if="${param.success}" th:text="${param.success}"></div>

    <form th:action="@{/profile/edit}" th:object="${dto}" method="post" enctype="multipart/form-data" novalidate>
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

      <div class="grid">
        <!-- Cột trái: Avatar -->
        <div>
          <div class="field">
            <label>Ảnh đại diện</label>
            <div class="avatar-box">
              <!-- 1 thẻ img duy nhất, chọn src theo điều kiện -->
             
                      <img th:src="${#strings.isEmpty(currentAvatar) ? '/uploads/avaatr/default.png' : currentAvatar}"
         class="profile-avatar" alt="avatar"/>
              <div class="help">Ảnh vuông 1:1 hiển thị đẹp hơn. Dung lượng ≤ 10MB.</div>
              <input class="file" id="avatarFile" type="file" name="avatarFile" accept="image/*" />
            </div>
          </div>
        </div>

        <!-- Cột phải: Form info -->
        <div>
          <div class="field">
            <label for="fullName">Họ và tên</label>
            <input id="fullName" type="text" th:field="*{fullName}" class="input" placeholder="Nhập họ tên đầy đủ" />
            <div class="err" th:if="${#fields.hasErrors('fullName')}" th:errors="*{fullName}"></div>
          </div>

          <div class="field">
            <label for="email">Email</label>
            <input id="email" type="email" th:field="*{email}" class="input" placeholder="email@domain.com" />
            <div class="err" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
          </div>

          <div class="field">
            <label for="phone">Số điện thoại</label>
            <input id="phone" type="text" th:field="*{phone}" class="input" placeholder="VD: 09xxxxxxxx" />
            <div class="err" th:if="${#fields.hasErrors('phone')}" th:errors="*{phone}"></div>
          </div>

          <!-- Lỗi chung (nếu có) – bọc riêng, tránh gộp th:if + th:each cùng 1 thẻ -->
          <div th:if="${#fields.hasGlobalErrors()}">
            <div class="err" th:each="ge : ${#fields.globalErrors()}" th:text="${ge}"></div>
          </div>

          <div class="btns">
            <button type="submit" class="btn btn-save">Lưu thay đổi</button>
            <a th:href="@{/profile}" class="btn btn-cancel">Huỷ</a>
          </div>
        </div>
      </div>
    </form>
  </div>
</main>

<!-- FOOTER -->
<div th:replace="~{fragments/footer :: siteFooter}"></div>

<script>
  // Xem trước ảnh ngay khi chọn file
  (function(){
    const input = document.getElementById('avatarFile');
    const preview = document.getElementById('avatarPreview');

    if (input) {
      input.addEventListener('change', function(){
        if (this.files && this.files[0]) {
          const f = this.files[0];
          if (f.size > 10 * 1024 * 1024) {
            alert('Ảnh vượt quá 10MB. Vui lòng chọn ảnh khác.');
            this.value = '';
            return;
          }
          const url = URL.createObjectURL(f);
          preview.src = url;
        }
      });
    }
  })();
</script>

</body>
</html>
