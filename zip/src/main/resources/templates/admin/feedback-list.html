<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω Ph·∫£n h·ªìi &amp; ƒê√°nh gi√°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body{display:flex}
        #sidebar{width:260px;height:100vh;position:fixed;background:#343a40;color:#fff;padding:1rem}
        #sidebar a{color:#fff;text-decoration:none;display:block;padding:8px 10px;border-radius:5px}
        #sidebar a:hover,#sidebar .active{background:#495057}
        #main-content{margin-left:260px;padding:2rem;flex-grow:1;background:#f8f9fa;min-height:100vh}
    </style>
</head>
<body>

<!-- sidebar -->
<div th:replace="fragments/sidebar :: sidebar(6)"></div>

<!-- main -->
<div id="main-content">

    <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
    <div th:if="${error}"   class="alert alert-danger"  th:text="${error}"></div>

    <div class="card shadow-sm">
        <div class="card-body">
            <h4 class="card-title mb-4">‚≠ê Qu·∫£n l√Ω Ph·∫£n h·ªìi &amp; ƒê√°nh gi√°</h4>

            <!-- filter -->
            <form class="row g-2 mb-4" th:action="@{/admin/feedback}" method="get">
                <div class="col-md-5">
                    <input class="form-control" name="keyword"
                           th:value="${keyword}"
                           placeholder="üîç T·ª´ kho√° (t√™n kh√°ch, n·ªôi dung‚Ä¶)">
                </div>
                <div class="col-md-3">
                    <select class="form-select" name="rating" onchange="this.form.submit()">
                        <!-- SAI tr∆∞·ªõc: <option th:value="">  -->
                        <option value="" th:selected="${rating==null}">-- T·∫•t c·∫£ s·ªë sao --</option>
                        <option th:each="i : ${#numbers.sequence(5,1)}"
                                th:value="${i}"
                                th:selected="${rating!=null and rating==i}"
                                th:text="${i + ' sao'}"></option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-outline-secondary w-100" type="submit">L·ªçc</button>
                </div>
            </form>

            <!-- table -->
            <div class="table-responsive">
                <table class="table table-bordered table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>Kh√°ch h√†ng</th>
                            <th>S·ªë&nbsp;sao</th>
                            <th>N·ªôi&nbsp;dung</th>
                            <th>Ph·∫£n&nbsp;h·ªìi&nbsp;Admin</th>
                            <th>Ng√†y&nbsp;g·ª≠i</th>
                            <th style="width:115px">H√†nh&nbsp;ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody>
                    <tr th:each="fb : ${feedbackList}">
                        <td>
                            <img th:src="${fb.customer.avatar != null} ?
                                         @{/uploads/avatar/{img}(img=${fb.customer.avatar})} :
                                         @{/uploads/avatar/default.png}"
                                 class="rounded-circle me-2" width="40" height="40">
                            <span th:text="${fb.customer.fullName}"></span>
                        </td>

                        <!-- hi·ªÉn th·ªã sao b·∫±ng v√≤ng l·∫∑p -->
                        <td>
                            <span th:if="${fb.rating != null}"
                                  th:each="i : ${#numbers.sequence(1, fb.rating)}">‚≠ê</span>
                        </td>

                        <td th:text="${fb.comment}"></td>

                        <td>
                            <em th:if="${fb.reply == null}" class="text-muted">Ch∆∞a ph·∫£n h·ªìi</em>
                            <span th:if="${fb.reply != null}" th:text="${fb.reply}"></span>
                        </td>

                        <td th:text="${#temporals.format(fb.createdAt,'yyyy-MM-dd HH:mm')}"></td>

                        <td class="text-center">
                            <a class="btn btn-sm btn-outline-primary"
                               th:href="@{|/admin/feedback/reply/${fb.id}|}">‚úâ Tr·∫£&nbsp;l·ªùi</a>
                        </td>
                    </tr>

                    <tr th:if="${#lists.isEmpty(feedbackList)}">
                        <td colspan="6" class="text-center text-muted">Kh√¥ng c√≥ ph·∫£n h·ªìi n√†o.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- auto-submit khi g√µ t·ª´ kho√° -->
<script>
    const kw=document.querySelector('input[name="keyword"]');
    if(kw){kw.addEventListener('keyup',()=>kw.form.requestSubmit());}
</script>
</body>
</html>
