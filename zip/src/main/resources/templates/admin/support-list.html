<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard - Qu·∫£n l√Ω H·ªó tr·ª£ & Khi·∫øu n·∫°i</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { display: flex; }
        #sidebar { width: 260px; height: 100vh; position: fixed; background-color: #343a40; color: white; padding: 1rem; }
        #sidebar a { color: white; text-decoration: none; display: block; padding: 8px 10px; border-radius: 5px; }
        #sidebar a:hover, #sidebar .active { background-color: #495057; }
        #main-content { margin-left: 260px; padding: 2rem; flex-grow: 1; background-color: #f8f9fa; min-height: 100vh; }
        .badge { font-size: 0.8em; }
    </style>
</head>
<body>

<!-- Sidebar -->
<div th:replace="fragments/sidebar :: sidebar(9)"></div>

<!-- Main content -->
<div id="main-content">
    <div class="card mt-4 shadow-sm">
        <div class="card-body">
            <h4 class="card-title mb-3">üõ†Ô∏è Qu·∫£n l√Ω H·ªó tr·ª£ & Khi·∫øu n·∫°i</h4>

            <!-- Form t√¨m ki·∫øm & l·ªçc -->
            <form th:action="@{/admin/support}" method="get" class="row mb-3">
                <div class="col-md-4">
                    <input type="text" name="keyword" class="form-control" placeholder="üîç T√¨m theo ti√™u ƒë·ªÅ, t√™n kh√°ch, n·ªôi dung..."
                           th:value="${keyword ?: ''}">
                </div>
                <div class="col-md-3">
                    <select name="status" class="form-select">
                        <option value="">-- Tr·∫°ng th√°i --</option>
                        <option th:each="status : ${T(com.example.model.SupportTicket.Status).values()}"
                                th:value="${status}"
                                th:text="${status}"
                                th:selected="${status.toString() == param.status}">
                        </option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100">T√¨m</button>
                </div>
                <div class="col-md-2">
                    <a th:href="@{/admin/support}" class="btn btn-outline-secondary w-100">L√†m m·ªõi</a>
                </div>
            </form>

            <!-- B·∫£ng d·ªØ li·ªáu -->
            <div class="table-responsive">
                <table class="table table-bordered align-middle">
                    <thead class="table-light">
                    <tr>
                        <th>Kh√°ch h√†ng</th>
                        <th>Lo·∫°i</th>
                        <th>Ti√™u ƒë·ªÅ</th>
                        <th>N·ªôi dung</th>
                        <th>·∫¢nh</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th>Ng√†y g·ª≠i</th>
                        <th>Thao t√°c</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="ticket : ${tickets}">
                        <td>
                            <img th:src="@{${ticket.user.avatar ?: '/images/default-avatar.png'}}"
                                 class="rounded-circle me-2" width="40" alt="avatar">
                            <span th:text="${ticket.user.fullName ?: 'Kh√°ch'}"></span>
                        </td>
                        <td>
                            <span class="badge"
                                  th:classappend="${ticket.type == 'booking' ? 'bg-info' :
                                                 ticket.type == 'payment' ? 'bg-danger' :
                                                 ticket.type == 'account' ? 'bg-warning text-dark' :
                                                 ticket.type == 'technical' ? 'bg-dark' :
                                                 ticket.type == 'suggestion' ? 'bg-secondary' : 'bg-light text-dark'}"
                                  th:text="${ticket.type}"></span>
                        </td>
                        <td th:text="${ticket.title}"></td>
                        <td th:text="${#strings.abbreviate(ticket.message, 50)}"></td>
                        <td>
                            <a th:if="${ticket.image != null}"
                               th:href="@{${ticket.image}}" target="_blank" class="btn btn-sm btn-link">Xem ·∫£nh</a>
                            <span th:if="${ticket.image == null}">-</span>
                        </td>
                        <td>
                            <span class="badge"
                                  th:classappend="${ticket.status == 'OPEN' ? 'bg-warning text-dark' :
                                                 ticket.status == 'IN_PROGRESS' ? 'bg-info' :
                                                 ticket.status == 'RESOLVED' ? 'bg-success' :
                                                 'bg-secondary'}"
                                  th:text="${ticket.status}"></span>
                        </td>
                        <td th:text="${#temporals.format(ticket.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
                        <td>
                            <a th:href="@{/admin/support/reply(id=${ticket.id})}" class="btn btn-sm btn-outline-primary">‚úâ Tr·∫£ l·ªùi</a>
                            <a th:if="${ticket.status != 'RESOLVED' and ticket.status != 'CLOSED'}"
                               th:href="@{/admin/support/resolve(id=${ticket.id})}"
                               class="btn btn-sm btn-outline-success">‚úî ƒê√°nh d·∫•u x·ª≠ l√Ω</a>
                            <button class="btn btn-sm btn-outline-secondary" disabled
                                    th:if="${ticket.status == 'RESOLVED' or ticket.status == 'CLOSED'}">‚úî ƒê√£ x·ª≠ l√Ω</button>
                        </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(tickets)}">
                        <td colspan="8" class="text-center text-muted">Kh√¥ng c√≥ y√™u c·∫ßu h·ªó tr·ª£ n√†o.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

</body>
</html>